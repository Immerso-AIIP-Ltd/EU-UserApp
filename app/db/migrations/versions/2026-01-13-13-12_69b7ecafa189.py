"""initial_schema_baseline.

Revision ID: 69b7ecafa189
Revises: 
Create Date: 2026-01-13 13:12:02.087507

"""

import sqlalchemy as sa
from alembic import op
import typing
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = "69b7ecafa189"
down_revision = None
branch_labels = None
depends_on = None


def upgrade() -> None:
    """Run the migration."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "invite_coupon",
        sa.Column("id", sa.UUID(), nullable=False),
        sa.Column("code", sa.String(), nullable=False),
        sa.Column("consumed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=False),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("code"),
    )
    op.create_table(
        "invite_device",
        sa.Column("device_id", sa.UUID(), nullable=False),
        sa.Column("coupon_id", sa.UUID(), nullable=True),
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["coupon_id"],
            ["invite_coupon.id"],
        ),
        sa.PrimaryKeyConstraint("device_id"),
    )
    op.alter_column(
        "app_consumer",
        "id",
        existing_type=sa.INTEGER(),
        type_=sa.UUID(),
        existing_nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "client_id",
        existing_type=sa.VARCHAR(length=40),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "client_secret",
        existing_type=sa.VARCHAR(length=40),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "is_internal",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "partner_code",
        existing_type=sa.VARCHAR(length=40),
        nullable=True,
        schema="user_app",
    )
    op.drop_column("app_consumer", "created_at", schema="user_app")
    op.drop_column("app_consumer", "updated_at", schema="user_app")
    op.drop_constraint(
        op.f("authentication_session_auth_token_key"),
        "authentication_session",
        schema="user_app",
        type_="unique",
    )
    op.drop_index(
        op.f("idx_auth_sessions_device"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_auth_sessions_expiry"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_auth_sessions_token"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_auth_sessions_user"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_auth_sessions_user_active"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_authentication_session_auth_token"),
        "authentication_session",
        ["auth_token"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_authentication_session_auth_token_expiry"),
        "authentication_session",
        ["auth_token_expiry"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_authentication_session_device_id"),
        "authentication_session",
        ["device_id"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_authentication_session_user_id"),
        "authentication_session",
        ["user_id"],
        unique=False,
        schema="user_app",
    )
    op.drop_constraint(
        op.f("fk_auth_session_device"),
        "authentication_session",
        schema="user_app",
        type_="foreignkey",
    )
    op.drop_constraint(
        op.f("fk_auth_session_user"),
        "authentication_session",
        schema="user_app",
        type_="foreignkey",
    )
    op.create_foreign_key(
        None,
        "authentication_session",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.create_foreign_key(
        None,
        "authentication_session",
        "device",
        ["device_id"],
        ["device_id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.add_column(
        "device",
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        schema="user_app",
    )
    op.alter_column(
        "device",
        "platform",
        existing_type=sa.VARCHAR(length=50),
        type_=sa.VARCHAR(length=20),
        existing_nullable=True,
        schema="user_app",
    )
    op.drop_index(op.f("idx_device_active"), table_name="device", schema="user_app")
    op.drop_index(
        op.f("idx_device_deactivated"), table_name="device", schema="user_app",
    )
    op.drop_index(op.f("idx_device_id"), table_name="device", schema="user_app")
    op.drop_index(op.f("idx_device_ip"), table_name="device", schema="user_app")
    op.drop_index(op.f("idx_device_jailbroken"), table_name="device", schema="user_app")
    op.drop_index(op.f("idx_device_platform"), table_name="device", schema="user_app")
    op.drop_index(op.f("idx_device_rooted"), table_name="device", schema="user_app")
    op.drop_index(op.f("idx_device_type"), table_name="device", schema="user_app")
    op.drop_index(op.f("idx_device_user"), table_name="device", schema="user_app")
    op.drop_index(
        op.f("idx_device_user_active"), table_name="device", schema="user_app",
    )
    op.drop_index(op.f("idx_device_vpn"), table_name="device", schema="user_app")
    op.create_index(
        op.f("ix_user_app_device_date_deactivated"),
        "device",
        ["date_deactivated"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_device_id"),
        "device",
        ["device_id"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_device_ip"),
        "device",
        ["device_ip"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_device_type"),
        "device",
        ["device_type"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_is_jailbroken"),
        "device",
        ["is_jailbroken"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_is_rooted"),
        "device",
        ["is_rooted"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_is_vpn"),
        "device",
        ["is_vpn"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_platform"),
        "device",
        ["platform"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_device_user_id"),
        "device",
        ["user_id"],
        unique=False,
        schema="user_app",
    )
    op.drop_constraint(
        op.f("fk_device_platform"), "device", schema="user_app", type_="foreignkey",
    )
    op.drop_constraint(
        op.f("fk_device_user"), "device", schema="user_app", type_="foreignkey",
    )
    op.create_foreign_key(
        None,
        "device",
        "platform",
        ["platform"],
        ["platform_name"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.create_foreign_key(
        None,
        "device",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.drop_column("device", "modified_at", schema="user_app")
    op.alter_column(
        "friend_invite",
        "invited_email",
        existing_type=sa.VARCHAR(length=255),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "friend_invite",
        "invited_mobile",
        existing_type=sa.VARCHAR(length=20),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "friend_invite",
        "invited_calling_code",
        existing_type=sa.VARCHAR(length=10),
        nullable=False,
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_invites_email"), table_name="friend_invite", schema="user_app",
    )
    op.drop_index(
        op.f("idx_invites_invited_user"), table_name="friend_invite", schema="user_app",
    )
    op.drop_index(
        op.f("idx_invites_inviter"), table_name="friend_invite", schema="user_app",
    )
    op.drop_index(
        op.f("idx_invites_mobile"), table_name="friend_invite", schema="user_app",
    )
    op.drop_index(
        op.f("idx_invites_status"), table_name="friend_invite", schema="user_app",
    )
    op.drop_index(
        op.f("idx_invites_token"), table_name="friend_invite", schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_friend_invite_invite_token"),
        "friend_invite",
        ["invite_token"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_friend_invite_invited_email"),
        "friend_invite",
        ["invited_email"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_friend_invite_invited_user_id"),
        "friend_invite",
        ["invited_user_id"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_friend_invite_inviter_id"),
        "friend_invite",
        ["inviter_id"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_friend_invite_status"),
        "friend_invite",
        ["status"],
        unique=False,
        schema="user_app",
    )
    op.drop_constraint(
        op.f("fk_friend_invite_invited_user"),
        "friend_invite",
        schema="user_app",
        type_="foreignkey",
    )
    op.drop_constraint(
        op.f("fk_friend_invite_inviter"),
        "friend_invite",
        schema="user_app",
        type_="foreignkey",
    )
    op.drop_constraint(
        op.f("fk_friend_invite_waitlist"),
        "friend_invite",
        schema="user_app",
        type_="foreignkey",
    )
    op.create_foreign_key(
        None,
        "friend_invite",
        "user",
        ["inviter_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.create_foreign_key(
        None,
        "friend_invite",
        "user",
        ["invited_user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.create_foreign_key(
        None,
        "friend_invite",
        "waitlist",
        ["waitlist_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.alter_column(
        "invite_coupon",
        "status",
        existing_type=sa.VARCHAR(length=50),
        type_=sa.Enum("active", "used", "expired", name="couponstatus"),
        nullable=False,
        schema="user_app",
    )
    op.create_unique_constraint(None, "invite_coupon", ["code"], schema="user_app")
    op.drop_constraint(
        op.f("invite_device_device_id_key"),
        "invite_device",
        schema="user_app",
        type_="unique",
    )
    op.create_unique_constraint(None, "invite_device", ["user_id"], schema="user_app")
    op.drop_constraint(
        op.f("fk_invite_device_user"),
        "invite_device",
        schema="user_app",
        type_="foreignkey",
    )
    op.drop_constraint(
        op.f("fk_invite_device_coupon"),
        "invite_device",
        schema="user_app",
        type_="foreignkey",
    )
    op.create_foreign_key(
        None,
        "invite_device",
        "device",
        ["device_id"],
        ["device_id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.create_foreign_key(
        None,
        "invite_device",
        "invite_coupon",
        ["coupon_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.create_foreign_key(
        None,
        "invite_device",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.alter_column(
        "otp_token",
        "email",
        existing_type=sa.VARCHAR(length=255),
        nullable=True,
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_otp_created"), table_name="otp_verification", schema="user_app",
    )
    op.drop_index(
        op.f("idx_otp_email_intent"), table_name="otp_verification", schema="user_app",
    )
    op.drop_index(
        op.f("idx_otp_mobile_intent"), table_name="otp_verification", schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_otp_verification_created_at"),
        "otp_verification",
        ["created_at"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_otp_verification_email"),
        "otp_verification",
        ["email"],
        unique=False,
        schema="user_app",
    )
    op.add_column(
        "platform",
        sa.Column("modified_on", sa.DateTime(timezone=True), nullable=True),
        schema="user_app",
    )
    op.alter_column(
        "platform",
        "platform_name",
        existing_type=sa.VARCHAR(length=50),
        nullable=True,
        schema="user_app",
    )
    op.drop_constraint(
        op.f("uq_platform_name"), "platform", schema="user_app", type_="unique",
    )
    op.create_index(
        op.f("ix_user_app_platform_platform_name"),
        "platform",
        ["platform_name"],
        unique=True,
        schema="user_app",
    )
    op.drop_column("platform", "modified_at", schema="user_app")
    op.drop_index(
        op.f("idx_social_provider_userid"),
        table_name="social_identity_provider",
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_social_user"),
        table_name="social_identity_provider",
        schema="user_app",
    )
    op.drop_index(
        op.f("idx_social_user_provider"),
        table_name="social_identity_provider",
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_social_identity_provider_user_id"),
        "social_identity_provider",
        ["user_id"],
        unique=False,
        schema="user_app",
    )
    op.drop_constraint(
        op.f("fk_social_identity_user"),
        "social_identity_provider",
        schema="user_app",
        type_="foreignkey",
    )
    op.create_foreign_key(
        None,
        "social_identity_provider",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.alter_column(
        "user",
        "email",
        existing_type=sa.VARCHAR(length=255),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "mobile",
        existing_type=sa.VARCHAR(length=20),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "calling_code",
        existing_type=sa.VARCHAR(length=10),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "state",
        existing_type=postgresql.ENUM(
            "inactive",
            "active",
            "blocked",
            "deactivated",
            name="user_state",
            schema="user_app",
        ),
        type_=sa.Enum("inactive", "active", "blocked", "deactivated", name="userstate"),
        nullable=False,
        existing_server_default=sa.text("'active'::user_app.user_state"),
        schema="user_app",
    )
    op.alter_column(
        "user",
        "login_type",
        existing_type=sa.VARCHAR(length=50),
        type_=sa.Enum("google", "facebook", "apple", name="logintype"),
        existing_nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "type",
        existing_type=postgresql.ENUM(
            "regular", "creator", name="user_type", schema="user_app",
        ),
        type_=sa.Enum("regular", "creator", name="usertype"),
        nullable=False,
        existing_server_default=sa.text("'regular'::user_app.user_type"),
        schema="user_app",
    )
    op.drop_index(op.f("idx_users_created_at"), table_name="user", schema="user_app")
    op.drop_index(op.f("idx_users_email"), table_name="user", schema="user_app")
    op.drop_index(
        op.f("idx_users_mobile_calling_code"), table_name="user", schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_user_created_at"),
        "user",
        ["created_at"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_user_email"),
        "user",
        ["email"],
        unique=True,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "token",
        existing_type=sa.VARCHAR(length=255),
        type_=sa.Text(),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "device_id",
        existing_type=sa.VARCHAR(length=255),
        type_=sa.VARCHAR(length=128),
        existing_nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "expires_at",
        existing_type=postgresql.TIMESTAMP(timezone=True),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "is_active",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "created_at",
        existing_type=postgresql.TIMESTAMP(timezone=True),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(timezone=True),
        nullable=True,
        schema="user_app",
    )
    op.drop_constraint(
        op.f("user_auth_token_device_id_fkey"),
        "user_auth_token",
        schema="user_app",
        type_="foreignkey",
    )
    op.drop_column("user_auth_token", "id", schema="user_app")
    op.drop_constraint(
        op.f("fk_user_profile_user"),
        "user_profile",
        schema="user_app",
        type_="foreignkey",
    )
    op.create_foreign_key(
        None,
        "user_profile",
        "user",
        ["id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.alter_column(
        "waitlist",
        "email",
        existing_type=sa.VARCHAR(length=255),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "waitlist",
        "mobile",
        existing_type=sa.VARCHAR(length=20),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "waitlist",
        "calling_code",
        existing_type=sa.VARCHAR(length=10),
        nullable=False,
        schema="user_app",
    )
    op.drop_index(op.f("idx_waitlist_device"), table_name="waitlist", schema="user_app")
    op.drop_index(op.f("idx_waitlist_email"), table_name="waitlist", schema="user_app")
    op.drop_index(op.f("idx_waitlist_mobile"), table_name="waitlist", schema="user_app")
    op.drop_index(op.f("idx_waitlist_queue"), table_name="waitlist", schema="user_app")
    op.drop_index(
        op.f("idx_waitlist_verified"), table_name="waitlist", schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_waitlist_device_id"),
        "waitlist",
        ["device_id"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_waitlist_email"),
        "waitlist",
        ["email"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_waitlist_is_verified"),
        "waitlist",
        ["is_verified"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("ix_user_app_waitlist_queue_number"),
        "waitlist",
        ["queue_number"],
        unique=False,
        schema="user_app",
    )
    op.drop_constraint(
        op.f("fk_waitlist_user"), "waitlist", schema="user_app", type_="foreignkey",
    )
    op.create_foreign_key(
        None,
        "waitlist",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.create_foreign_key(
        None,
        "waitlist",
        "device",
        ["device_id"],
        ["device_id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Undo the migration."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(
        typing.cast(str, None), "waitlist", schema="user_app", type_="foreignkey"
    )
    op.drop_constraint(
        typing.cast(str, None), "waitlist", schema="user_app", type_="foreignkey"
    )
    op.create_foreign_key(
        op.f("fk_waitlist_user"),
        "waitlist",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="SET NULL",
    )
    op.drop_index(
        op.f("ix_user_app_waitlist_queue_number"),
        table_name="waitlist",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_waitlist_is_verified"),
        table_name="waitlist",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_waitlist_email"), table_name="waitlist", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_waitlist_device_id"), table_name="waitlist", schema="user_app",
    )
    op.create_index(
        op.f("idx_waitlist_verified"),
        "waitlist",
        ["is_verified"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_waitlist_queue"),
        "waitlist",
        ["queue_number"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_waitlist_mobile"),
        "waitlist",
        ["mobile", "calling_code"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_waitlist_email"),
        "waitlist",
        ["email"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_waitlist_device"),
        "waitlist",
        ["device_id"],
        unique=True,
        schema="user_app",
    )
    op.alter_column(
        "waitlist",
        "calling_code",
        existing_type=sa.VARCHAR(length=10),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "waitlist",
        "mobile",
        existing_type=sa.VARCHAR(length=20),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "waitlist",
        "email",
        existing_type=sa.VARCHAR(length=255),
        nullable=True,
        schema="user_app",
    )
    op.drop_constraint(
        typing.cast(str, None), "user_profile", schema="user_app", type_="foreignkey"
    )
    op.create_foreign_key(
        op.f("fk_user_profile_user"),
        "user_profile",
        "user",
        ["id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="CASCADE",
    )
    op.add_column(
        "user_auth_token",
        sa.Column("id", sa.INTEGER(), autoincrement=True, nullable=False),
        schema="user_app",
    )
    op.create_foreign_key(
        op.f("user_auth_token_device_id_fkey"),
        "user_auth_token",
        "device",
        ["device_id"],
        ["device_id"],
        source_schema="user_app",
        referent_schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(timezone=True),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "created_at",
        existing_type=postgresql.TIMESTAMP(timezone=True),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "is_active",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "expires_at",
        existing_type=postgresql.TIMESTAMP(timezone=True),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "device_id",
        existing_type=sa.VARCHAR(length=128),
        type_=sa.VARCHAR(length=255),
        existing_nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user_auth_token",
        "token",
        existing_type=sa.Text(),
        type_=sa.VARCHAR(length=255),
        nullable=False,
        schema="user_app",
    )
    op.drop_index(op.f("ix_user_app_user_email"), table_name="user", schema="user_app")
    op.drop_index(
        op.f("ix_user_app_user_created_at"), table_name="user", schema="user_app",
    )
    op.create_index(
        op.f("idx_users_mobile_calling_code"),
        "user",
        ["mobile", "calling_code"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_users_email"), "user", ["email"], unique=True, schema="user_app",
    )
    op.create_index(
        op.f("idx_users_created_at"),
        "user",
        ["created_at"],
        unique=False,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "type",
        existing_type=sa.Enum("regular", "creator", name="usertype"),
        type_=postgresql.ENUM(
            "regular", "creator", name="user_type", schema="user_app",
        ),
        nullable=True,
        existing_server_default=sa.text("'regular'::user_app.user_type"),
        schema="user_app",
    )
    op.alter_column(
        "user",
        "login_type",
        existing_type=sa.Enum("google", "facebook", "apple", name="logintype"),
        type_=sa.VARCHAR(length=50),
        existing_nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "state",
        existing_type=sa.Enum(
            "inactive", "active", "blocked", "deactivated", name="userstate",
        ),
        type_=postgresql.ENUM(
            "inactive",
            "active",
            "blocked",
            "deactivated",
            name="user_state",
            schema="user_app",
        ),
        nullable=True,
        existing_server_default=sa.text("'active'::user_app.user_state"),
        schema="user_app",
    )
    op.alter_column(
        "user",
        "calling_code",
        existing_type=sa.VARCHAR(length=10),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "mobile",
        existing_type=sa.VARCHAR(length=20),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "user",
        "email",
        existing_type=sa.VARCHAR(length=255),
        nullable=True,
        schema="user_app",
    )
    op.drop_constraint(
        typing.cast(str, None),
        "social_identity_provider",
        schema="user_app",
        type_="foreignkey",
    )
    op.create_foreign_key(
        op.f("fk_social_identity_user"),
        "social_identity_provider",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="CASCADE",
    )
    op.drop_index(
        op.f("ix_user_app_social_identity_provider_user_id"),
        table_name="social_identity_provider",
        schema="user_app",
    )
    op.create_index(
        op.f("idx_social_user_provider"),
        "social_identity_provider",
        ["user_id", "provider"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_social_user"),
        "social_identity_provider",
        ["user_id"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_social_provider_userid"),
        "social_identity_provider",
        ["provider", "provider_user_id"],
        unique=True,
        schema="user_app",
    )
    op.add_column(
        "platform",
        sa.Column(
            "modified_at",
            postgresql.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            autoincrement=False,
            nullable=True,
        ),
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_platform_platform_name"),
        table_name="platform",
        schema="user_app",
    )
    op.create_unique_constraint(
        op.f("uq_platform_name"),
        "platform",
        ["platform_name"],
        schema="user_app",
        postgresql_nulls_not_distinct=False,
    )
    op.alter_column(
        "platform",
        "platform_name",
        existing_type=sa.VARCHAR(length=50),
        nullable=False,
        schema="user_app",
    )
    op.drop_column("platform", "modified_on", schema="user_app")
    op.drop_index(
        op.f("ix_user_app_otp_verification_email"),
        table_name="otp_verification",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_otp_verification_created_at"),
        table_name="otp_verification",
        schema="user_app",
    )
    op.create_index(
        op.f("idx_otp_mobile_intent"),
        "otp_verification",
        ["mobile", "calling_code"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_otp_email_intent"),
        "otp_verification",
        ["email"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_otp_created"),
        "otp_verification",
        ["created_at"],
        unique=False,
        schema="user_app",
    )
    op.alter_column(
        "otp_token",
        "email",
        existing_type=sa.VARCHAR(length=255),
        nullable=False,
        schema="user_app",
    )
    op.drop_constraint(
        typing.cast(str, None), "invite_device", schema="user_app", type_="foreignkey"
    )
    op.drop_constraint(
        typing.cast(str, None), "invite_device", schema="user_app", type_="foreignkey"
    )
    op.drop_constraint(
        typing.cast(str, None), "invite_device", schema="user_app", type_="foreignkey"
    )
    op.create_foreign_key(
        op.f("fk_invite_device_coupon"),
        "invite_device",
        "invite_coupon",
        ["coupon_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="SET NULL",
    )
    op.create_foreign_key(
        op.f("fk_invite_device_user"),
        "invite_device",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="CASCADE",
    )
    op.drop_constraint(
        typing.cast(str, None), "invite_device", schema="user_app", type_="unique"
    )
    op.create_unique_constraint(
        op.f("invite_device_device_id_key"),
        "invite_device",
        ["device_id"],
        schema="user_app",
        postgresql_nulls_not_distinct=False,
    )
    op.drop_constraint(
        typing.cast(str, None), "invite_coupon", schema="user_app", type_="unique"
    )
    op.alter_column(
        "invite_coupon",
        "status",
        existing_type=sa.Enum("active", "used", "expired", name="couponstatus"),
        type_=sa.VARCHAR(length=50),
        nullable=True,
        schema="user_app",
    )
    op.drop_constraint(
        typing.cast(str, None), "friend_invite", schema="user_app", type_="foreignkey"
    )
    op.drop_constraint(
        typing.cast(str, None), "friend_invite", schema="user_app", type_="foreignkey"
    )
    op.drop_constraint(
        typing.cast(str, None), "friend_invite", schema="user_app", type_="foreignkey"
    )
    op.create_foreign_key(
        op.f("fk_friend_invite_waitlist"),
        "friend_invite",
        "waitlist",
        ["waitlist_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="SET NULL",
    )
    op.create_foreign_key(
        op.f("fk_friend_invite_inviter"),
        "friend_invite",
        "user",
        ["inviter_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="CASCADE",
    )
    op.create_foreign_key(
        op.f("fk_friend_invite_invited_user"),
        "friend_invite",
        "user",
        ["invited_user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="SET NULL",
    )
    op.drop_index(
        op.f("ix_user_app_friend_invite_status"),
        table_name="friend_invite",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_friend_invite_inviter_id"),
        table_name="friend_invite",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_friend_invite_invited_user_id"),
        table_name="friend_invite",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_friend_invite_invited_email"),
        table_name="friend_invite",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_friend_invite_invite_token"),
        table_name="friend_invite",
        schema="user_app",
    )
    op.create_index(
        op.f("idx_invites_token"),
        "friend_invite",
        ["invite_token"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_invites_status"),
        "friend_invite",
        ["status"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_invites_mobile"),
        "friend_invite",
        ["invited_mobile", "invited_calling_code"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_invites_inviter"),
        "friend_invite",
        ["inviter_id"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_invites_invited_user"),
        "friend_invite",
        ["invited_user_id"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_invites_email"),
        "friend_invite",
        ["invited_email"],
        unique=False,
        schema="user_app",
    )
    op.alter_column(
        "friend_invite",
        "invited_calling_code",
        existing_type=sa.VARCHAR(length=10),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "friend_invite",
        "invited_mobile",
        existing_type=sa.VARCHAR(length=20),
        nullable=True,
        schema="user_app",
    )
    op.alter_column(
        "friend_invite",
        "invited_email",
        existing_type=sa.VARCHAR(length=255),
        nullable=True,
        schema="user_app",
    )
    op.add_column(
        "device",
        sa.Column(
            "modified_at",
            postgresql.TIMESTAMP(timezone=True),
            server_default=sa.text("now()"),
            autoincrement=False,
            nullable=True,
        ),
        schema="user_app",
    )
    op.drop_constraint(
        typing.cast(str, None), "device", schema="user_app", type_="foreignkey"
    )
    op.drop_constraint(
        typing.cast(str, None), "device", schema="user_app", type_="foreignkey"
    )
    op.create_foreign_key(
        op.f("fk_device_user"),
        "device",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="SET NULL",
    )
    op.create_foreign_key(
        op.f("fk_device_platform"),
        "device",
        "platform",
        ["platform"],
        ["platform_name"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="SET NULL",
    )
    op.drop_index(
        op.f("ix_user_app_device_user_id"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_platform"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_is_vpn"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_is_rooted"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_is_jailbroken"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_device_type"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_device_ip"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_device_id"), table_name="device", schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_device_date_deactivated"),
        table_name="device",
        schema="user_app",
    )
    op.create_index(
        op.f("idx_device_vpn"), "device", ["is_vpn"], unique=False, schema="user_app",
    )
    op.create_index(
        op.f("idx_device_user_active"),
        "device",
        ["user_id", "device_active"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_device_user"), "device", ["user_id"], unique=False, schema="user_app",
    )
    op.create_index(
        op.f("idx_device_type"),
        "device",
        ["device_type"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_device_rooted"),
        "device",
        ["is_rooted"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_device_platform"),
        "device",
        ["platform"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_device_jailbroken"),
        "device",
        ["is_jailbroken"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_device_ip"), "device", ["device_ip"], unique=False, schema="user_app",
    )
    op.create_index(
        op.f("idx_device_id"), "device", ["device_id"], unique=True, schema="user_app",
    )
    op.create_index(
        op.f("idx_device_deactivated"),
        "device",
        ["date_deactivated"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_device_active"),
        "device",
        ["device_id", "device_active"],
        unique=False,
        schema="user_app",
    )
    op.alter_column(
        "device",
        "platform",
        existing_type=sa.VARCHAR(length=20),
        type_=sa.VARCHAR(length=50),
        existing_nullable=True,
        schema="user_app",
    )
    op.drop_column("device", "updated_at", schema="user_app")
    op.drop_constraint(
        typing.cast(str, None),
        "authentication_session",
        schema="user_app",
        type_="foreignkey",
    )
    op.drop_constraint(
        typing.cast(str, None),
        "authentication_session",
        schema="user_app",
        type_="foreignkey",
    )
    op.create_foreign_key(
        op.f("fk_auth_session_user"),
        "authentication_session",
        "user",
        ["user_id"],
        ["id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="CASCADE",
    )
    op.create_foreign_key(
        op.f("fk_auth_session_device"),
        "authentication_session",
        "device",
        ["device_id"],
        ["device_id"],
        source_schema="user_app",
        referent_schema="user_app",
        ondelete="SET NULL",
    )
    op.drop_index(
        op.f("ix_user_app_authentication_session_user_id"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_authentication_session_device_id"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_authentication_session_auth_token_expiry"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.drop_index(
        op.f("ix_user_app_authentication_session_auth_token"),
        table_name="authentication_session",
        schema="user_app",
    )
    op.create_index(
        op.f("idx_auth_sessions_user_active"),
        "authentication_session",
        ["user_id", "is_active"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_auth_sessions_user"),
        "authentication_session",
        ["user_id"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_auth_sessions_token"),
        "authentication_session",
        ["auth_token"],
        unique=True,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_auth_sessions_expiry"),
        "authentication_session",
        ["auth_token_expiry"],
        unique=False,
        schema="user_app",
    )
    op.create_index(
        op.f("idx_auth_sessions_device"),
        "authentication_session",
        ["device_id"],
        unique=False,
        schema="user_app",
    )
    op.create_unique_constraint(
        op.f("authentication_session_auth_token_key"),
        "authentication_session",
        ["auth_token"],
        schema="user_app",
        postgresql_nulls_not_distinct=False,
    )
    op.add_column(
        "app_consumer",
        sa.Column(
            "updated_at",
            postgresql.TIMESTAMP(timezone=True),
            autoincrement=False,
            nullable=False,
        ),
        schema="user_app",
    )
    op.add_column(
        "app_consumer",
        sa.Column(
            "created_at",
            postgresql.TIMESTAMP(timezone=True),
            autoincrement=False,
            nullable=False,
        ),
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "partner_code",
        existing_type=sa.VARCHAR(length=40),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "is_internal",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "client_secret",
        existing_type=sa.VARCHAR(length=40),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "client_id",
        existing_type=sa.VARCHAR(length=40),
        nullable=False,
        schema="user_app",
    )
    op.alter_column(
        "app_consumer",
        "id",
        existing_type=sa.UUID(),
        type_=sa.INTEGER(),
        existing_nullable=False,
        schema="user_app",
    )
    op.drop_table("invite_device")
    op.drop_table("invite_coupon")
    # ### end Alembic commands ###
